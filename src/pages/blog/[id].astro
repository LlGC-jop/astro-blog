---
import Layout from '../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { id: post.id },
    props: { post },
  }));
}

const { id } = Astro.params;
const { post } = Astro.props;
const { Content } = await render(post);

// for prev/next posts

// 1. Load all posts
const posts = await getCollection('blog');

// 2. Find current post
const index = posts.findIndex((p) => p.id === id);
const entry = posts[index];
if (!entry) throw new Error(`Post not found: ${id}`);

// 3. Compute previous & next
const prev = posts[index + 1]; // because sorted descending
const next = posts[index - 1];
---

<Layout>
  <h1>{post.data.title}</h1>
  <Content />

  <hr />

  <nav class="post-nav">
    {
      next && (
        <div class="next-post">
          <>
            <strong>Next post</strong>
            <br />
          </>
          <a href={`/blog/${next.id}`}>{next.data.title}</a>
        </div>
      )
    }

    {
      prev && (
        <div class="prev-post">
          <>
            <strong>Previous post</strong>
            <br />
          </>
          <a href={`/blog/${prev.id}`}>{prev.data.title}</a>
        </div>
      )
    }
  </nav>
</Layout>
